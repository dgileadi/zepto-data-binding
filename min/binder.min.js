$(document).ready(function(){$(document.body).binder()}),function($){var nextId=0,inited=!1,settings=null,bindings={},methods={options:function(a){settings=$.extend({bindAttributes:["bind-checked","bind-class","bind-disabled","bind-readonly","bind-selected","bind-src","bind-style"],separatorSymbol:",",decimalSymbol:".",currencySymbol:"$"},a)},init:function(a){inited||(inited=!0,$(document.body).binder("options",{})),$("[bind]",this).each(function(){$(this).binder("bind",$(this).attr("bind"),a)}),$("[data-bind]",this).each(function(){$(this).binder("bind",$(this).data("bind"),a)});for(var b=0;b<settings.bindAttributes.length;b++){var c=settings.bindAttributes[b];$("["+c+"]",this).each(function(){$(this).binder("bind",$(this).attr(c),a,c.slice(5))}),$("[data-"+c+"]",this).each(function(){$(this).binder("bind",$(this).data(c),a,c.slice(5))})}$("[repeat]",this).each(function(){$(this).binder("repeat",$(this).attr("repeat"),a)}),$("[data-repeat]",this).each(function(){$(this).binder("repeat",$(this).data("repeat"),a)})},bind:function(a,b,c){a&&$(this).each(function(){var d=$(this).is("input")||$(this).is("select")||$(this).is("textarea");if(d){var e=function(){binder.sync()};($(this).attr("immediate")||$(this).data("immediate"))&&$(this).on("keyup",e),$(this).on("change",e)}$(this).attr("id")||$(this).attr("id","_binder_id_"+nextId++);var i,f=parseGetter(a),g=d?parseSetter(a):null,h="#"+$(this).attr("id");g&&(i=c?function(){return $(h).prop(c)}:function(){return $(h).val()});var j;j=c?function(a){if("boolean"==typeof a)$(h).prop(c,a);else if("class"==c){var b=$(h).data("zdb-class");b&&$(h).removeClass(b),a&&a!=b&&($(h).hasClass(a)||$(h).addClass(a)),$(h).data("zdb-class",a)}else $(h).attr(c,a)}:d?function(a){$(h).val(a)}:function(a){$(h).text(a)},createBinding(h,f,g,i,j,b)})},unbind:function(){return $(this).each(function(){var a="#"+$(this).attr("id");delete bindings[a]}),this},repeat:function(a,b){if(a){var c=a.split(/\s*\bin\b\s*/i);if(2==c.length){var d=c[0].split(/\s*,\s*/),e=1==d.length?null:d[0],f=1==d.length?d[0]:d[1],g=function(a,b,c,d){a.first=b,a.middle=!b,a.last=!1,a[f]=c[d],e&&(a[e]=d)};$(this).each(function(){var a=$(this);a.attr("id")||a.attr("id","_binder_id_"+nextId++);var d=a.attr("id");a.hide(),$("[id]",a).binder("unbind");var e=parseGetter(c[1]),f=createBinding("#"+d,e,null,null,function(){},b);f.domSetter=function(c){var e=$("[data-"+d+"_clone]",a.parent());if(c){var h,f=a,i=!0;for(var j in c)if(Object.prototype.hasOwnProperty.call(c,j)){var k=d+"_clone_"+j,l=$("#"+k);if(l.length){e=e.not(l),h=findBindings($("[id]",l));for(var m=0;m<h.length;m++)g(h[m].scope,i,c,j)}else{var n=new LocalScope(b);h=[n],n.index=j,g(n,i,c,j),l=a.clone(),l.insertAfter(f),l.removeAttr("repeat").removeAttr("data-repeat"),l.attr("id",k),l.attr("data-"+d+"_clone",!0),suffixIds(l,"_clone_"+j),l.binder("init",n),l.show()}i=!1,f=l}for(var m=0;m<h.length;m++)h[m].middle=!1,h[m].last=!0}e.trigger("removerepeat"),$("[id]",e).binder("unbind"),e.remove()},f.value=null,f.sync()})}}}};$.fn.binder=function(a){if(methods[a])return methods[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof a&&a)throw"Method "+a+" does not exist";return methods.init.apply(this,arguments)},safeArgs=function(a){var c,b=a;do c=b,b=c.replace(/([\w\.\(\)\{\}\|]*\b(?![\d])\w+)\./,"($1||{}).");while(b!=c);return c.replace(/(^|\s|\()((?!\d|false|true|this|null|undefined)\w+)/gi,"$1scope.$2")},parseGetter=function(expression){for(var filters=expression.split(/\s*\|\s*/g),result=safeArgs(filters[0]),i=1;i<filters.length;i++){var args=filters[i].split(/\s*:\s*/g);result="binder.filters."+args[0]+"("+result;for(var j=1;j<args.length;j++)result+=", "+safeArgs(args[j]);result+=")"}return function(scope){return eval(result)}},parseSetter=function(expression){var r=/['"|+\-*/%<>&\^=~!]|\b(\d+|false|true|null|undefined)\b/i;if(r.test(expression))return null;var parts=expression.split(/\./g);return function(scope,value){if(parts&&parts.length>1){for(var parent=scope,i=0;i<parts.length;i++)parent[parts[i]]||(parent[parts[i]]=i<parts.length-1?{}:""),parent=parent[parts[i]];parts=null}eval("scope."+expression+" = value")}},createBinding=function(a,b,c,d,e,f){f||(f=binder.scope);var g={id:a,scope:f,domGetter:d,modelGetter:b,domSetter:e,modelSetter:c,sync:function(){var a,b=this.modelGetter(this.scope);if(compareObjects(b,this.value)){if(!this.domGetter)return!1;var c=this.domGetter();if(c==this.value)return!1;this.value=c,a="model"}else this.value=b,a="dom";return"dom"===a?this.domSetter(this.value):this.modelSetter&&"model"===a&&this.modelSetter(this.scope,this.value),a&&console.log("sync happened for "+this.id+': "'+this.value+'" to '+a),null!=a},isDirty:function(){return this.modelGetter(this.scope)!=this.value||this.domGetter&&this.domGetter()!=this.value}};return g.sync(),bindings[a]||(bindings[a]=[]),bindings[a].push(g),g},findBindings=function(a){var b=[];return $(a).each(function(){var a="#"+$(this).attr("id");bindings[a]&&(b=b.concat(bindings[a]))}),b},compareObjects=function(a,b){if(a==b)return!0;if(null==a||null==b)return!1;if("object"==typeof a&&"object"==typeof b){if(a.length&&b.length&&a.length!=b.length)return!1;for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)&&a[c]!=b[c])return!1;return!0}return!1},suffixIds=function(a,b){a.children().each(function(){var c=$(this).attr("id");c&&($(this).attr("id",c+b),$('[for="'+c+'"]',a).attr("for",c+b)),suffixIds($(this),b)})},filter=function(a,b){if(!a||!b)return a;var c;return c="function"==typeof b?b:"string"==typeof b?function(a){if("string"==typeof a)return-1!=a.indexOf(b);for(var c in a)if(-1!=String(a[c]).indexOf(b))return!0;return!1}:function(a){for(var c in b)if("$"===c){var d=!1;for(var e in a)if(-1!=String(a[e]).indexOf(b[c])){d=!0;break}if(!d)return!1}else{if(null==a[c])return!1;if(-1==String(a[c]).indexOf(String(b[c])))return!1}return!0},a.filter(c)},orderBy=function(a,b,c){if(!a||!b)return a;var d=[];b=[].concat(b);for(var e=function(a,b){var d;return d=isNaN(a)||isNaN(b)?a>b?1:-1:a-b,c?-d:d},f=0;f<b.length;f++){var g=b[f];if("function"==typeof g)d.push({func:g,f:function(a,b){return e(this.func(a),this.func(b))}});else if("string"==typeof g){var h="-"==g.charAt(0),i=g.replace(/^[+\-]\s*/,"");d.push({prop:i,f:function(a,b){var c=e(a[this.prop],b[this.prop]);return h?-c:c}})}}var j=a.slice(0);return j.sort(function(a,b){for(var c=0;c<d.length;c++){var e=d[c].f(a,b);if(0!=e)return e}return 0}),j},limitTo=function(a,b,c){return a&&a.length&&(c&&(c>0&&c<a.length?a=a.slice(c):0>c&&-c<a.length&&(a=a.slice(0,a.length+c))),b>0&&b<a.length?a=a.slice(0,b):0>b&&-b<a.length&&(a=a.slice(a.length+b))),a},number=function(a,b,c,d){if(!a)return a;null==c&&(c=settings.separatorSymbol),null==d&&(d=settings.decimalSymbol),a=String(a);var e=a.indexOf(".");if(-1===e?(e=a.length,b&&(a+=d)):"."!=d&&(a=a.slice(0,e)+d+a.slice(e+1)),b)if(e+b+1<a.length)a=a.slice(0,e+1+b);else for(;e+b+1>a.length;)a+="0";for(e-=3;e>0;)a=a.slice(0,e)+c+a.slice(e),e-=3;return a},currency=function(a,b,c,d,e){return(b||settings.currencySymbol)+number(a,c||2,d,e)},date=function(a,b){return window.dateFormat?dateFormat(a,b):a},json=function(a){return JSON.stringify(a)},lowercase=function(a){return a?a.toLowerCase():a},uppercase=function(a){return a?a.toUpperCase():a},window.binder={scope:{window:window},filters:{currency:currency,date:date,filter:filter,json:json,limitTo:limitTo,lowercase:lowercase,number:number,orderBy:orderBy,uppercase:uppercase},sync:function(){for(var a=0;10>a;a++){var b=!1;for(var c in bindings)for(var d=bindings[c],e=0;e<d.length;e++)b|=d[e].sync();if(!b)break}}},LocalScope=function(){this.prototype=binder.scope}}(Zepto);