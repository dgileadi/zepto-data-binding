$(document).ready(function(){$(document.body).binder()});
(function(b){var t=0,u=!1,k=null,g={},q={options:function(a){k=b.extend({bindAttributes:"bind-checked bind-class bind-disabled bind-readonly bind-selected bind-src bind-style".split(" "),separatorSymbol:",",decimalSymbol:".",currencySymbol:"$"},a)},init:function(a){u||(u=!0,b(document.body).binder("options",{}));b("[bind]",this).each(function(){b(this).binder("bind",b(this).attr("bind"),a)});b("[data-bind]",this).each(function(){b(this).binder("bind",b(this).data("bind"),a)});for(var c=0;c<k.bindAttributes.length;c++){var e=
k.bindAttributes[c];b("["+e+"]",this).each(function(){b(this).binder("bind",b(this).attr(e),a,e.slice(5))});b("[data-"+e+"]",this).each(function(){b(this).binder("bind",b(this).data(e),a,e.slice(5))})}b("[repeat]",this).each(function(){b(this).binder("repeat",b(this).attr("repeat"),a)});b("[data-repeat]",this).each(function(){b(this).binder("repeat",b(this).data("repeat"),a)})},bind:function(a,c,e){a&&b(this).each(function(){var f=b(this).is("input")||b(this).is("select")||b(this).is("textarea");
if(f){var d=function(){binder.sync()};if(b(this).attr("immediate")||b(this).data("immediate"))b(this).on("keyup",d);b(this).on("change",d)}b(this).attr("id")||b(this).attr("id","_binder_id_"+t++);var d=parseGetter(a),l=f?parseSetter(a):null,j="#"+b(this).attr("id"),v;l&&(v=e?function(){return b(j).prop(e)}:function(){return b(j).val()});createBinding(j,d,l,v,e?function(a){"boolean"===typeof a?b(j).prop(e,a):b(j).attr(e,a)}:f?function(a){b(j).val(a)}:function(a){b(j).text(a)},c)})},unbind:function(){b(this).each(function(){var a=
"#"+b(this).attr("id");delete g[a]});return this},repeat:function(a,c){if(a){var e=a.split(/\s*\bin\b\s*/i);if(2==e.length){var f=e[0].split(/\s*,\s*/),d=1==f.length?null:f[0],l=1==f.length?f[0]:f[1];b(this).each(function(){var a=b(this);a.attr("id")||a.attr("id","_binder_id_"+t++);var f=a.attr("id");a.hide();b("[id]",a).binder("unbind");var i=parseGetter(e[1]),i=createBinding("#"+f,i,null,null,function(){},c);i.domSetter=function(e){var r=b("[data-"+f+"_clone]",a.parent());if(e){var i=a,g,k=!0,n;
for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var m=f+"_clone_"+n,h=b("#"+m);if(h.length){r=r.not(h);g=findBindings(b("[id]",h));for(i=0;i<g.length;i++){var m=g[i].scope,p=k,q=e,s=n;m.first=p;m.middle=!p;m.last=!1;m[l]=q[s];d&&(m[d]=s)}}else p=new LocalScope(c),g=[p],p.index=n,h=p,q=e,s=n,h.first=k,h.middle=!k,h.last=!1,h[l]=q[s],d&&(h[d]=s),h=a.clone(),h.insertAfter(i),h.removeAttr("repeat").removeAttr("data-repeat"),h.attr("id",m),h.attr("data-"+f+"_clone",!0),suffixIds(h,"_clone_"+n),
h.binder("init",p),h.show();k=!1;i=h}for(i=0;i<g.length;i++)g[i].middle=!1,g[i].last=!0}r.trigger("removerepeat");b("[id]",r).binder("unbind");r.remove()};i.value=null;i.sync()})}}}};b.fn.binder=function(a){if(q[a])return q[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return q.init.apply(this,arguments);throw"Method "+a+" does not exist";};safeArgs=function(a){var c;do c=a,a=c.replace(/([\w\.\(\)\{\}\|]*\b(?![\d])\w+)\./,"($1||{}).");while(a!=c);return c.replace(/(^|\s|\()((?!\d|false|true|this|null|undefined)\w+)/ig,
"$1scope.$2")};parseGetter=function(a){for(var a=a.split(/\s*\|\s*/g),c=safeArgs(a[0]),e=1;e<a.length;e++){for(var b=a[e].split(/\s*:\s*/g),c="binder.filters."+b[0]+"("+c,d=1;d<b.length;d++)c+=", "+safeArgs(b[d]);c+=")"}return function(scope){return eval(c)}};parseSetter=function(a){if(/['"|+\-*/%<>&\^=~!]|\b(\d+|false|true|null|undefined)\b/i.test(a))return null;var c=a.split(/\./g);return function(scope, value){if(c&&1<c.length){var p=scope;for(var b=0;b<c.length;b++)p[c[b]]||(p[c[b]]=b<c.length-1?{}:""),p=p[c[b]];c=null}eval("scope."+
a+" = value")}};createBinding=function(a,c,e,b,d,l){l||(l=binder.scope);c={id:a,scope:l,domGetter:b,modelGetter:c,domSetter:d,modelSetter:e,sync:function(){var a;a=this.modelGetter(this.scope);if(compareObjects(a,this.value))if(this.domGetter)if(a=this.domGetter(),a!=this.value)this.value=a,a="model";else return!1;else return!1;else this.value=a,a="dom";"dom"===a?this.domSetter(this.value):this.modelSetter&&"model"===a&&this.modelSetter(this.scope,this.value);a&&console.log("sync happened for "+this.id+
': "'+this.value+'" to '+a);return null!=a},isDirty:function(){return this.modelGetter(this.scope)!=this.value||this.domGetter&&this.domGetter()!=this.value}};c.sync();g[a]||(g[a]=[]);g[a].push(c);return c};findBindings=function(a){var c=[];b(a).each(function(){var a="#"+b(this).attr("id");g[a]&&(c=c.concat(g[a]))});return c};compareObjects=function(a,c){if(a==c)return!0;if(null==a||null==c)return!1;if("object"===typeof a&&"object"===typeof c){if(a.length&&c.length&&a.length!=c.length)return!1;for(var e in a)if(Object.prototype.hasOwnProperty.call(a,
e)&&a[e]!=c[e])return!1;return!0}return!1};suffixIds=function(a,c){a.children().each(function(){var e=b(this).attr("id");e&&(b(this).attr("id",e+c),b('[for="'+e+'"]',a).attr("for",e+c));suffixIds(b(this),c)})};filter=function(a,c){return!a||!c?a:a.filter("function"===typeof c?c:"string"===typeof c?function(a){if("string"===typeof a)return-1!=a.indexOf(c);for(var b in a)if(-1!=String(a[b]).indexOf(c))return!0;return!1}:function(a){for(var b in c)if("$"===b){var d=!1,g;for(g in a)if(-1!=String(a[g]).indexOf(c[b])){d=
!0;break}if(!d)return!1}else if(null==a[b]||-1==String(a[b]).indexOf(String(c[b])))return!1;return!0})};orderBy=function(a,c,b){if(!a||!c)return a;for(var f=[],c=[].concat(c),d=function(a,c){var d;d=isNaN(a)||isNaN(c)?a>c?1:-1:a-c;return b?-d:d},g=0;g<c.length;g++){var j=c[g];if("function"===typeof j)f.push({func:j,f:function(a,c){return d(this.func(a),this.func(c))}});else if("string"===typeof j){var k="-"==j.charAt(0),j=j.replace(/^[+\-]\s*/,"");f.push({prop:j,f:function(a,c){var b=d(a[this.prop],
c[this.prop]);return k?-b:b}})}}a=a.slice(0);a.sort(function(a,c){for(var b=0;b<f.length;b++){var e=f[b].f(a,c);if(0!=e)return e}return 0});return a};limitTo=function(a,c,b){a&&a.length&&(b&&(0<b&&b<a.length?a=a.slice(b):0>b&&-b<a.length&&(a=a.slice(0,a.length+b))),0<c&&c<a.length?a=a.slice(0,c):0>c&&-c<a.length&&(a=a.slice(a.length+c)));return a};number=function(a,c,b,f){if(!a)return a;null==b&&(b=k.separatorSymbol);null==f&&(f=k.decimalSymbol);var a=String(a),d=a.indexOf(".");-1===d?(d=a.length,
c&&(a+=f)):"."!=f&&(a=a.slice(0,d)+f+a.slice(d+1));if(c)if(d+c+1<a.length)a=a.slice(0,d+1+c);else for(;d+c+1>a.length;)a+="0";for(d-=3;0<d;)a=a.slice(0,d)+b+a.slice(d),d-=3;return a};currency=function(a,c,b,f,d){return(c||k.currencySymbol)+number(a,b||2,f,d)};date=function(a,c){return window.dateFormat?dateFormat(a,c):a};json=function(a){return JSON.stringify(a)};lowercase=function(a){return a?a.toLowerCase():a};uppercase=function(a){return a?a.toUpperCase():a};window.binder={scope:{window:window},
filters:{currency:currency,date:date,filter:filter,json:json,limitTo:limitTo,lowercase:lowercase,number:number,orderBy:orderBy,uppercase:uppercase},sync:function(){for(var a=0;10>a;a++){var c=!1,b;for(b in g)for(var f=g[b],d=0;d<f.length;d++)c|=f[d].sync();if(!c)break}}};LocalScope=function(){this.prototype=binder.scope}})(Zepto);